<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Estilos/interacao.css">
    <title>JOGO</title>
</head>
<body onload="verify_carta()">
    <header>
        <div class="container">
            <nav>
                <li><a href="index.html">Home</a></li>
                <li><span id="nome_usuario"></span> <img class="gif_lua" src="https://media.tenor.com/9pMpw3ZD4CEAAAAC/storymaker-moon.gif" alt="gif" style="width:30px;"></li>
            </nav>
        </div>
    </header>
    <section class="content">
        <div class="game">
            <div class="game_top" id="titulo_game">
                <div class="game_top_content">
                    <span class="title"><b>ScapeRoom</b>: Sala do Einstein.</span>
                    <span class="text_normal">Tente resolver o enigma para escapar da sala do einstein.</span>
                    <span class="text_normal">Ajuste o tamanho da tela até que o ponto vermelho esteja no canto da tela.</span>
                </div>
            </div>

            <!-- Tela principal -->
            <div id="game_area1" class="game_images">
                <img src="Estilos/Imagens/scape room/fundo.png">
                <button onclick="game_area1_tabela()" class="game_area1_tabela"></button>
                <button onclick="game_area1_jornal()" class="game_area1_journal"></button>
                <button onclick="game_area1_foto()" class="game_area1_foto"></button>
                <button onclick="game_area1_cofre()" class="game_area1_cofre"></button>
                <button onclick="game_area1_relogio()" class="game_area1_relogio"></button>
                <button onclick="game_area1_galaxiasGuia()" class="game_area1_galaxiasGuia"></button>
                <button onclick="game_area1_galaxias()" class="game_area1_galaxias"></button>

                <span style="color: red; font-size: 80pt" class="point">.</span>
            </div>

            <!-- Tela tabela periodica -->
            <div id="game_area2" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/tabelaCortada.png">
                <span class="text_information">Uma tabela periodica! alguns desses elementos são aprendidos na escola, como "B" sendo o Boro, o "Co" sendo o cobalto. Mas o C eu não consigo lembrar... me lembra um banco.</span>
                <button class="exit_button_style" id="exit_button1" onclick="exit1()"></button>
            </div>

            <!-- Tela jornal -->
            <div id="game_area3" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/journalGrifado.png">
                <span class="text_information">Um jornal antigo falando sobre o einstein. a manchete tem algo grifado, "... <span style="color:rgb(202, 226, 49);">Albert einstein foi laureado com o 25º premio nobel da física</span>...". Talvez seja importante!</span>
                <button class="exit_button_style" id="exit_button2" onclick="exit2()"></button>
            </div>

            <!-- Tela foto -->
            <div id="game_area4" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/fotoEinstein.png">
                <span class="text_information">Uma das fotos que einstein enviava para seus amigos, ele as autografava... Espera! Esse autografo... "De Albert Einstein para (carbon * √(SBb / S0)) * <span style="color:red;">?</span>"... o último numero está ilegivel. O que ele queria dizer com isso?</span>
                <button class="exit_button_style" id="exit_button3" onclick="exit3()"></button>
            </div>

            <!-- Tela cofre -->
            <!-- Cofre fechado -->
            <div id="game_area5_1" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/cofre(arrumado).png">
                <span class="text_information">Um cofre velho que só pode ser aberto com uma combinação de três números. O que sera que tem aqui dentro!?</span>
                <button class="exit_button_style" id="exit_button4" onclick="exit5()"></button>

                <input type="text" class="sequencia2" id="seq2" maxlength="1" onkeyup="verify_seq()">
                <input type="text" class="sequencia1" id="seq1" maxlength="1" onkeyup="verify_seq()">
                <input type="text" class="sequencia3" id="seq3" maxlength="1" onkeyup="verify_seq()">
            </div>
            <!-- Cofre aberto -->
            <div id="game_area5_2" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/cofre.png">
                <span class="text_information">Um cofre velho que só pode ser aberto com uma combinação de três números. O que sera que tem aqui dentro!?</span>
                <button class="exit_button_style" id="exit_button5" onclick="exit5()"></button>
            </div>

            <!-- Relogio -->
            <div id="game_area6" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/Relogio na parede.png">
                <span class="text_information_clock">Veja só, já estou nessa sala a <span id="minutes_stopwatcher"></span></span>
                <button class="exit_button_style" id="exit_button6" onclick="exit6()"></button>
            </div>

            <!-- Livro guia -->
            <div id="game_area7" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/livroGalaxiasGuia2.png">
                <span class="text_information">Galaxias espirais, elipticas, espiral barrada e irregulares. Existem varios tipos delas. A mais proxima fica a  2,54 milhões de anos-luz. O que significa que se apontassem um telescopio para nós eles veriam os dinossauros na terra!</span>
                <button class="exit_button_style" id="exit_button7" onclick="exit7()"></button>
            </div>

            <!-- Livro com o enigma -->
            <div id="game_area8" class="game_images" style="display: none;">
                <img src="Estilos/Imagens/scape room/livroGalaxias.png">
                <span class="text_information">Um livro com fotografias de galaxias! Esses formatos parecem ter sido feitos a mão.</span>
                <button class="exit_button_style" id="exit_button8" onclick="exit8()"></button>
            </div>

            <!-- Finalizado -->
            <div id="game_area9" class="gameFinalizado" style="display: none;">
                <div class="gameFinalizado_content">
                    <div class="key_area">
                        <span>Parabéns!! você encontrou a chave para a saída, clique para ver seu ranking</span>
                        <a href="metricas.html"><div><img src="Estilos/Imagens/scape room/chave.png" style="width: 100px;"></div></a>
                    </div>
                    <div class="content" id="escrever_msg">
                        <span class="title">Maquina do tempo</span>
                        <span class="sub_title">Envie uma mensagem para o seu eu do futuro (maximo 250 caracteres)</span>
                        <input type="text" class="msg_future" id="msg_future_id" maxlength="250">
                        <button onclick="enviarCarta()">Enviar</button>
                    </div>
                    <div class="content" id="vizualizar_msg" style="display: none;">
                        <span class="title">Maquina do tempo</span>
                        <span class="sub_title">Veja a carta que você enviou</span>
                        <button>Vizualizar</button>
                    </div>
                </div>
            </div>

        </div>
    </section>
</body>
</html>
<script>
    const nome = sessionStorage.NOME_USUARIO;
    nome_usuario.innerHTML = `${nome}`;
    var fkUsuario = sessionStorage.ID_USUARIO;


    var seconds = 0;
    var minutes = 0;
    var secondTemp = 0;
    var minuteTemp = 0;
    var hours = 0;
    var hoursTemp = 0;
    var cronometro = true;
    var teste = 0; 

    function time(){
        seconds++;
        if(seconds < 10){
            secondTemp = ('0' + String(seconds))
        }else{
            secondTemp = seconds
        }
        if(minutes < 10){
            minuteTemp = ('0' + String(minutes))
        }else{
            minuteTemp = minutes
        }

        if(hours < 10){
            hoursTemp = ('0' + String(hours))
        }else{
            hoursTemp = hours
        }

        if(minutes == 0){
            minutes_stopwatcher.innerHTML = `${hoursTemp}:${minuteTemp}:${secondTemp} segundos!`
        }else{
            minutes_stopwatcher.innerHTML = `${hoursTemp}:${minuteTemp}:${secondTemp} minutos!`
        }
        if(minutes == 60){
            minutes = 0;
            hours ++;
        }
        if(seconds==60){
            minutes++;
            seconds=0;
        }
    }
    if(cronometro){
        setInterval(function(){ time() },1000)
    }

    // Tela principal
    function game_area1_tabela(){
        game_area1.style.display = "none"
        game_area2.style.display = "flex"
    }
    function game_area1_jornal(){
        game_area3.style.display = "flex"
        game_area1.style.display = "none"
    }
    function game_area1_foto(){
        game_area4.style.display = "flex"
        game_area1.style.display = "none"
    }
    function game_area1_cofre(){
        game_area5_1.style.display = "flex"
        game_area1.style.display = "none"
    }
    function game_area1_relogio(){
        game_area6.style.display = "flex"
        game_area1.style.display = "none"
        var stopwatcher = true;
    }
    function game_area1_galaxiasGuia(){
        game_area7.style.display = "flex"
        game_area1.style.display = "none"
    }
    function game_area1_galaxias(){
        game_area8.style.display = "flex"
        game_area1.style.display = "none"
    }


    // Botão sair
    function exit1(){
        game_area1.style.display = "flex"
        game_area2.style.display = "none"
    }
    function exit2(){
        game_area1.style.display = "flex"
        game_area3.style.display = "none"
    }
    function exit3(){
        game_area1.style.display = "flex"
        game_area4.style.display = "none"
    }
    function exit4(){
        game_area1.style.display = "flex"
        game_area5.style.display = "none"
    }
    function exit5(){
        seq1.value = '';
        seq2.value = '';
        seq3.value = '';
        game_area1.style.display = "flex"
        game_area5_1.style.display = "none"
    }
    function exit6(){
        game_area1.style.display = "flex"
        game_area6.style.display = "none"
        stopwatcher = false;
    }
    function exit7(){
        game_area1.style.display = "flex"
        game_area7.style.display = "none"
    }
    function exit8(){
        game_area1.style.display = "flex"
        game_area8.style.display = "none"
    }
    var tempo = `${hoursTemp}:${minuteTemp}:${secondTemp}`;
    // Sequencia do cofre
    function verify_seq(){
        if(seq1.value == '5' && seq2.value == '4' && seq3.value == '0'){
            game_area9.style.display = 'flex'
            game_area5_1.style.display = 'none'
            titulo_game.style.display = 'none'
            cronometro = false;
            tempo = `${hoursTemp}:${minuteTemp}:${secondTemp}`
            tempoSegundos = 0;

            var ary_time = [hoursTemp, minuteTemp, secondTemp];
            for (let index = 0; index < 3; index ++){
                if(Number(ary_time[index]) > 00){
                    if(index == 0){
                        tempoSegundos += Number(ary_time[index]) * 3600
                    }
                    if(index == 1){
                        tempoSegundos += Number(ary_time[index]) * 60
                    }
                    if(index == 2){
                        tempoSegundos += Number(ary_time[index])
                    }
                }
            }
            regis(tempo, tempoSegundos)
        }
    }

    function regis(){
            // Enviando o valor da nova input
            fetch("/usuarios/regis", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    tempoServer: tempo,
                    tempoSegundosServer: tempoSegundos,
                    fkUsuarioServer: fkUsuario
                })
            }).then(function (resposta) {
    
                console.log("resposta: ", resposta);
    
                if (resposta.ok) {
                    
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
            return false;
    }

    function verify_carta(){
        fetch("/usuarios/verify_carta", {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkUsuarioServer: fkUsuario
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                });

            } else {

                alert("Não tem carta")
                console.log("Houve um erro ao tentar realizar o login!");
                
                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }
    

    function enviarCarta(){
        enviar_msg.style.display = none;
        vizualizar_msg.style.display = flex;
        var msg = msg_future_id.value
            // Enviando o valor da nova input
            fetch("/usuarios/msg", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    msgServer: msg,
                    fkUsuarioServer: fkUsuario
                })
            }).then(function (resposta) {
    
                console.log("resposta: ", resposta);
    
                if (resposta.ok) {
                    
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
            return false;
    }

</script>